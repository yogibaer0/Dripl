<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AMEBA</title>

  <!-- ===== Dynamic Environment Config (injected by script & server) ===== -->
  <meta name="supabase-url" content="{{SUPABASE_URL}}">
  <meta name="supabase-anon-key" content="{{SUPABASE_ANON_KEY}}">
  <meta name="api-base" content="{{API_BASE}}">
  <meta name="page-nonce" content="{{NONCE}}">

  <!-- ===== Optional SEO ===== -->
  <meta name="description" content="Ameba — the creative engine, media converter and digital goo workspace built for creators.">
  <meta name="theme-color" content="#8b5cf6">

  <!-- ===== Styles ===== -->
  <link rel="stylesheet" href="/styles.css">

  <!-- ===== Supabase UMD (with SRI + nonce inserted at build time) ===== -->
  <script {{SUPABASE_SRI_ATTR}} src="/vendor/supabase.min.js" nonce="{{NONCE}}"></script>

  <!-- ===== Bootstrap Config for Window Globals ===== -->
  <script nonce="{{NONCE}}">
    (function () {
      const getMeta = n => document.querySelector(`meta[name="${n}"]`)?.content?.trim() || "";
      window.__APP__ = {
        NONCE: getMeta("page-nonce"),
        API_BASE: getMeta("api-base"),
        SUPABASE_URL: getMeta("supabase-url"),
        SUPABASE_ANON_KEY: getMeta("supabase-anon-key")
      };
    })();
  </script>
</head>

<body>
  <header class="hero">
    <h1 class="hero__title">AMEBA</h1>
    <div class="glow-line">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 10" preserveAspectRatio="none">
        <path d="M0,5 Q200,0 400,5" stroke="#8b5cf6" stroke-width="2" fill="none" opacity=".3"/>
      </svg>
    </div>
  </header>

  <!-- Input for local upload (a11y-friendly, must not be display:none) -->
  <label for="fileInput" class="sr-only">Local file upload</label>
  <input id="fileInput" type="file" accept="video/*,image/*" aria-hidden="true">

  <main class="shell">
    <div class="panels">

      <!-- ================= UPLOAD PANEL ================= -->
      <section class="card upload" aria-labelledby="upload-title">
        <div class="card__head"><h2 id="upload-title">Upload</h2></div>
        <div class="card__body">
          <div id="dropzone" class="dropzone" aria-label="Drop files here">
            <div class="dropzone__hint">
              <p>Drop files or paste a link</p>
            </div>
          </div>

          <div class="upload__controls">
            <input id="paste-input" class="input" placeholder="Paste media link…">
            <select id="format" class="select" aria-label="Output format">
              <option value="mp4">MP4</option>
              <option value="mp3">MP3</option>
              <option value="gif">GIF</option>
            </select>
            <button id="convert-btn" class="btn btn--primary">Convert</button>
          </div>
          <p class="muted">Tip: press <kbd>Enter</kbd> to convert.</p>
        </div>
      </section>

      <!-- ================= IMPORT GOO PANEL ================= -->
      <section class="card import" aria-labelledby="import-title">
        <div class="card__head"><h2 id="import-title">Import</h2></div>
        <div class="card__body">
          <div class="goo-container">
            <svg class="goo-bg" viewBox="0 0 1000 320" preserveAspectRatio="none">
              <path id="importGoo" d="M0,140 Q500,210 1000,140 L1000,320 L0,320 Z"></path>
            </svg>

            <div class="icon-row">
              <button class="import-icon" id="imp-device" aria-label="This device"></button>
              <button class="import-icon" id="imp-dropbox" aria-label="Dropbox"></button>
              <button class="import-icon" id="imp-drive" aria-label="Google Drive"></button>
            </div>
          </div>
        </div>
      </section>

      <!-- ================= STORAGE PANEL ================= -->
      <section class="card storage">
        <div class="card__head">
          <h2>Storage</h2>
          <div class="toolbar">
            <button class="btn secondary">+ Folder</button>
            <button class="btn secondary">Filters</button>
            <button class="btn secondary">Presets</button>
          </div>
        </div>
        <div class="card__body">
          <input id="storage-search" type="text" placeholder="Search…">
          <div class="chips">
            <button class="chip chip--active">Recent</button>
            <button class="chip">Saved ★</button>
            <button class="chip">In progress</button>
            <button class="chip">Shared</button>
            <button class="chip">Trash</button>
          </div>
          <div id="storage-list" class="grid"></div>
        </div>
      </section>

      <!-- ================= DESTINATION HUB ================= -->
      <section class="card dest">
        <div id="destHub" class="dest-panel">
          <div class="dest-left">
            <div id="previewWrap" class="preview-wrap" style="position:relative;">
  <img id="previewImg" hidden>
  <video id="previewVideo" playsinline muted loop controls hidden></video>
  <div id="previewHint" class="preview-hint"><span>Preview</span></div>

  <!-- satDock: invisible pixel-accurate docking point for satellites -->
  <div id="satDock" aria-hidden="true"
       style="position:absolute; left:18px; top:18px; width:56px; height:56px; pointer-events:none;"></div>
</div>
          </div>

          <div class="dest-right">
            <div class="meta-grid">
              <div class="meta-row"><span>Filename</span><div id="metaFilename" class="pill">—</div></div>
              <div class="meta-row"><span>Duration</span><div id="metaDuration" class="pill">—</div></div>
              <div class="meta-row"><span>Resolution</span><div id="metaResolution" class="pill">—</div></div>
              <div class="meta-row"><span>Codec</span><div id="metaCodec" class="pill">—</div></div>
            </div>

            <div class="dest-actions">
              <div class="dest-buttons">
                <button class="btn btn-ghost" data-target="tiktok">TikTok</button>
                <button class="btn btn-ghost" data-target="instagram">Instagram</button>
                <button class="btn btn-ghost" data-target="youtube">YouTube</button>
                <button class="btn btn-ghost" data-target="reddit">Reddit</button>
              </div>

              <div class="dest-toggles">
                <label><input type="checkbox" id="optWatermark"> Watermark</label>
                <label><input type="checkbox" id="optAutotrim"> Auto-trim</label>
                <label><input type="checkbox" id="optAutofit"> Auto-fit</label>
                <label><input type="checkbox" id="optFaceFilters"> Face filters</label>
              </div>

              <button id="convertSelected" class="btn btn--primary">Convert Selected</button>
            </div>
          </div>
        </div>

        <div class="dest-sat-rail">
          <div class="dest-sat-stack">
  <!-- data-platform must match the platform keys used in script (youtube, instagram, tiktok, reddit) -->
  <button class="satellite sat--yt" data-platform="youtube" aria-label="YouTube satellite" title="YouTube"></button>
  <button class="satellite sat--ig" data-platform="instagram" aria-label="Instagram satellite" title="Instagram"></button>
  <button class="satellite sat--tt" data-platform="tiktok" aria-label="TikTok satellite" title="TikTok"></button>
  <button class="satellite sat--rd" data-platform="reddit" aria-label="Reddit satellite" title="Reddit"></button>
</div>
          <button id="satReturn" class="sat-return" hidden>Return</button>
        </div>
      </section>

    </div>
  </main>

  <script src="/script.js" nonce="{{NONCE}}"></script>

  <!-- small dropzone glow helper -->
  <script nonce="{{NONCE}}">
    const dz=document.getElementById('dropzone');
    if(dz){
      ["dragenter","dragover"].forEach(t=>dz.addEventListener(t,e=>{e.preventDefault();dz.classList.add("dropzone--over");}));
      ["dragleave","drop"].forEach(t=>dz.addEventListener(t,e=>{e.preventDefault();dz.classList.remove("dropzone--over");}));
    }
  </script>
</body>
</html>
.
















