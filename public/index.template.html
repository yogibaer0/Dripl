<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AMEBA</title>

  <!-- ===== Config (injected by server.ts) ===== -->
  <meta name="supabase-url" content="{{SUPABASE_URL}}">
  <meta name="supabase-anon-key" content="{{SUPABASE_ANON_KEY}}">
  <meta name="api-base" content="{{API_BASE}}">
  <meta name="page-nonce" content="{{NONCE}}">

  <!-- ===== Styles ===== -->
  <link rel="stylesheet" href="/styles.css" />

  <!-- ===== Security: local UMD + CSP nonce ===== -->
  <script {{SUPABASE_SRI_ATTR}} src="/vendor/supabase.min.js" nonce="{{NONCE}}"></script>

  <!-- Bootstrap config for JS -->
  <script nonce="{{NONCE}}">
    (function () {
      const meta = (n) => document.querySelector(`meta[name="${n}"]`)?.content?.trim() || "";
      window.__APP__ = {
        NONCE: meta("page-nonce"),
        API_BASE: meta("api-base") || "",
        SUPABASE_URL: meta("supabase-url"),
        SUPABASE_ANON_KEY: meta("supabase-anon-key")
      };
    }());
  </script>
</head>

<body>
  <header class="hero">
    <h1 class="hero__title">AMEBA</h1>
    <div class="glow-line">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 10" preserveAspectRatio="none">
        <path d="M0,5 Q200,0 400,5" stroke="#8b5cf6" stroke-width="2" fill="none" opacity=".3"/>
      </svg>
    </div>
  </header>

  <main class="shell">
    <div class="panels">

      <!-- Upload -->
      <section class="card panel--upload upload" aria-labelledby="h-upload">
        <div class="card__head"><h2 id="h-upload">Upload</h2></div>
        <div class="card__body">
          <div class="dropzone" id="dropzone" aria-label="Drop files here">
            <div class="dropzone__hint">
              <p>Drag &amp; drop files here or paste a link below</p>
            </div>
          </div>

          <div class="upload__controls">
            <input id="paste-input" class="input" placeholder="Paste media link…" />
            <select id="format" class="select">
              <option value="mp4">MP4 (video)</option>
              <option value="mp3">MP3 (audio)</option>
              <option value="gif">GIF</option>
            </select>
            <button id="convert-btn" class="btn btn--primary">Convert</button>
          </div>

          <p class="muted">Tip: press <kbd>Enter</kbd> to convert instantly.</p>
        </div>
      </section>

      <!-- Import card -->
<section class="panel import" aria-label="Import">
  <header>Import</header>

  <!-- Goo background lives here (you'll animate the <path> later) -->
  <div class="goo-container">
    <svg class="goo-bg" viewBox="0 0 1000 320" preserveAspectRatio="none">
      <path id="importGoo" d="M0,140 Q500,210 1000,140 L1000,320 L0,320 Z"></path>
    </svg>

    <!-- ICON ROW (bottom half, centered) -->
    <div class="icon-row" role="group" aria-label="Import sources">
      <button class="import-icon" id="imp-device"  aria-label="This device" title="This device"></button>
      <button class="import-icon" id="imp-dropbox" aria-label="Dropbox"     title="Dropbox"></button>
      <button class="import-icon" id="imp-drive"   aria-label="Google Drive" title="Google Drive"></button>
      <!-- add more here (MEGA, OneDrive, etc) -->
    </div>
  </div>
</section>


<!-- Dropbox -->
<div class="import_col">
  <h3>Dropbox</h3>
  <button class="btn btn--icon" id="btn-dropbox">
    <img class="icon" src="/assets/dropbox-icon.svg" alt="" aria-hidden="true" />
    <span>Connect Dropbox</span>
  </button>
  <p class="muted">Direct links, multi-select</p>
</div>

<!-- Google Drive -->
<div class="import_col">
  <h3>Google Drive</h3>
  <button class="btn btn--icon" id="btn-gdrive">
    <img class="icon" src="/assets/google-drive-logo.svg" alt="" aria-hidden="true" />
    <span>Connect Google Drive</span>
  </button>
  <p class="muted">Picker with OAuth</p>
</div>

        </div>
      </section>

      <!-- Storage -->
      <section class="card panel--storage storage" aria-labelledby="h-storage">
        <div class="card__head">
          <h2 id="h-storage">Storage</h2>
          <div class="toolbar">
            <button class="btn secondary">+ Folder</button>
            <button class="btn secondary">Filters</button>
            <button class="btn secondary">Presets</button>
          </div>
        </div>
        <div class="card__body">
          <div class="storage__search">
            <input id="storage-search" type="text" placeholder="Search files, tags, notes…" />
          </div>
          <div class="chips">
            <button class="chip chip--active">Recent</button>
            <button class="chip">Saved ★</button>
            <button class="chip">In progress</button>
            <button class="chip">Shared</button>
            <button class="chip">Trash</button>
          </div>
          <div class="grid" id="storage-list"></div>
        </div>
      </section>

      <!-- Destination Hub (full-width) -->
      <section class="card panel--dest" aria-label="Destination Hub">
        <div class="card__head"><h2 class="hidden">Destination Hub</h2></div>
        <div class="card__body">
          <section id="destHub" class="dest-panel" aria-label="Preview, metadata and actions">
            <!-- LEFT: big square preview -->
            <div class="dest-left">
              <div class="preview-wrap" id="previewWrap" aria-live="polite">
                <img id="previewImg" alt="Preview" />
                <div class="preview-hint" id="previewHint">
                  <span>Preview</span>
                  <span class="muted">• 1:1 • drag a file above or paste a link</span>
                </div>
              </div>
            </div>

            <!-- RIGHT: meta + actions -->
            <div class="dest-right">
              <div class="meta-grid" role="list">
                <div class="meta-row" role="listitem">
                  <label class="meta-label">Filename</label>
                  <div class="pill" id="metaFilename">—</div>
                </div>
                <div class="meta-row" role="listitem">
                  <label class="meta-label">Duration</label>
                  <div class="pill" id="metaDuration">—</div>
                </div>
                <div class="meta-row" role="listitem">
                  <label class="meta-label">Resolution</label>
                  <div class="pill" id="metaResolution">—</div>
                </div>
                <div class="meta-row" role="listitem">
                  <label class="meta-label">Codec</label>
                  <div class="pill" id="metaCodec">—</div>
                </div>
              </div>

              <div class="dest-actions">
                <div class="dest-buttons">
                  <button class="btn btn-ghost" data-target="tiktok">TikTok</button>
                  <button class="btn btn-ghost" data-target="instagram">Instagram</button>
                  <button class="btn btn-ghost" data-target="youtube">YouTube</button>
                  <button class="btn btn-ghost" data-target="reddit">Reddit</button>
                </div>

                <div class="dest-toggles">
                  <label class="toggle"><input type="checkbox" id="optWatermark" /> <span>Watermark</span></label>
                  <label class="toggle"><input type="checkbox" id="optAutotrim" /> <span>Auto-trim</span></label>
                  <label class="toggle"><input type="checkbox" id="optAutofit" /> <span>Auto-fit to platform</span></label>
                  <label class="toggle"><input type="checkbox" id="optFaceFilters" /> <span>Face filters</span></label>
                </div>

                <button id="convertSelected" class="btn btn--primary">Convert Selected</button>
              </div>
            </div>
          </section>
        </div>
      </section>

    </div>
  </main>

  <!-- Your app script (kept external for CSP) -->
  <script src="/script.js" nonce="{{NONCE}}"></script>

  <!-- Tiny helper for drop glow; safe to keep here or move into /script.js -->
  <script nonce="{{NONCE}}">
    (function(){
      const dz = document.getElementById('dropzone');
      if (!dz) return;

      const on = (t, fn) => dz.addEventListener(t, fn, false);
      const stop = (e) => { e.preventDefault(); e.stopPropagation(); };

      on('dragenter', e => { stop(e); dz.classList.add('dropzone--over'); });
      on('dragover',  e => { stop(e); dz.classList.add('dropzone--over'); });
      on('dragleave', e => { stop(e); dz.classList.remove('dropzone--over'); });
      on('drop',      e => {
        stop(e);
        dz.classList.remove('dropzone--over');
        dz.classList.add('dropzone--absorbing');
        setTimeout(()=>dz.classList.remove('dropzone--absorbing'), 600);
        // TODO: hand off e.dataTransfer.files to your existing handler
        // window.handleDroppedFiles?.(e.dataTransfer.files);
      });
    }());
  </script>
</body>
</html>






















